===========================   冲刺 熬住 抛开三流程序员   ===========================
# 一、多线程

## 1. 综合
1. 说说对并发编程的理解 (深信服、百度)
> 

2. 什么是线程安全？为什么不安全？ (蚂蚁*2、多益)
>

3. 并发和并行的区别？(字节飞书)
> 并发执行指 多任务在同一CPU核上抢夺时间片 交替执行，java的多线程编程使用的是并发
> 并行执行指 多任务在不同的CPU核上同时执行，互不抢占CPU资源

4. 怎么把一个对象变成线程安全 / 一般怎么样才能做到线程安全？ (蚂蚁、拼多多、多益)
> 1.加锁让公共变量同步 Synchronized, Lock
> 2.使用线程安全的集合 如 ConcurrentHashMap
>     使用volatile关键字修饰 或 atomic 原子类，如 AtomicInteger，保证变量可见性（直接从内存读，而不是从线程cache读），对其进行修改时使用CAS进行比较
>     如果 自定义的类 或像BigDecimal这种没有原生的原子类，可以放到AtomicReference里面进行引用

4. 手写：阻塞队列实现、信号量实现 多线程生产者消费者 (美团)


6. 线程状态有几种？(美团、华为、工信部电子五所、字节飞书)
> new, runnable, blocked 阻塞等待竞争获得锁, waiting等待显式唤醒, time_waiting, terminated 结束或者抛异常

7. 线程间通信的方式，wait-notify (携程、网易云音乐)
> 可以通过 synchronized 同步代码里面进行阻塞等待/唤醒，或者Lock.condition 进行线程之间的控制

8. 在Java中创建线程有哪几种方式？ (华为、工信部电子五所、京东科技、百度、京东科技)
> 3种，继承Thread 重写run方法
> Thread 构造器里面放 Runnable or Callable 实现类，可以用lambda 简写函数式接口，也可以用外部类来实现
> 由线程池submit() 提交 Runnable 和 Callable，两个函数式接口区别在于有无输出

9. 如何判断死锁，怎么避免死锁 (多益)
10. java里面的线程和操作系统的线程一样吗？ (腾讯音乐)
11. CompletableFuture 你知道吗？ (阿里Lazada)
> 开启异步线程

13. 我一个请求进来，通过隐式方式，在线程内如何隐式的传递uuid (京东)
13. CountDownLatch你知道吗？说一下。信号量呢？ (阿里Lazada、京东)
    - 在什么场景用过，减是用什么方法 (京东)

## 2. 锁
1. synchronized 底层实现 (小米、字节飞书、美团)
2. 在JDK升级中，synchronized 是怎么改进的
3. synchronized 锁升级、锁降级，可重入锁 (有赞、京东)
1. synchronized 和 lock 的区别，lock是公平吗 (携程、京东)
2. Java 里面的锁有哪些，用过哪些？(京东科技、京东)
3. ReentrantLock、AQS (美团、小米)
4. ReentrantLock 的实现原理？(京东科技、字节番茄)
5. 说说可重入锁、为什么需要可重入锁？ (字节番茄、字节飞书、京东)
6. Java 有哪些同步方案，如果不加锁呢，加锁会不会太重了 (字节番茄小说)
7. 一个轻量级锁怎么变成一个重量级锁的呢？ (阿里Lazada)
8. 项目中锁的应用，分布式锁 (快手)


## 3. 线程安全 Collections
1. 有哪些线程安全的集合类，讲一讲原理 (美团优选)
> HashTable，ConcurrentHashMap 都是HashMap的线程安全的实现，区别在于 ConcurrentHashMap 通过xxx来实现线程安全相对高效
> CopyOnWriteArrayList

2. ConcurrentHashMap
    1. HashMap是线程安全的吗？为什么呢？ (蚂蚁、美团、陌陌、京东)
    2. 如何让 HashMap 线程安全 (蚂蚁、陌陌、小米)
    3. ConcurrentHashMap为什么是线程安全的？ (蚂蚁、拼多多、小米、京东)
        - 通过 cas + synchronized 实现，线程操作前 先判断刚才是否有人在扩容或者在修改这个桶的数据
    4. jdk 1.8里面改进成了CAS 说一下你的理解 (小米)
3. BlockingQueue
    1. 从可重入锁出发，写出基于可重入锁的阻塞队列，怎么实现 (美团)


## 4. 原子类、CAS
1. 说说 volatile 作用和原理？怎么保证可见性的？ (蚂蚁、美团优选、小红书、小米、OPPO提前批、京东科技、京东)
2. volatile 和 synchronized 区别 (蚂蚁)
3. 写出volatile解决可见性的代码 (美团)
4. 用volatile修饰的变量来记录访问次数，需要其他同步操作吗 (字节番茄小说)
    - 从Java内存模型JMM的角度讲volatile，说明指令中的lock前缀和将esp寄存器的值+0这个空操作
5. 哪些可以保证原子性，CAS做乐观锁吧 (京东)
6. 说说 CAS (OPPO提前批)
7. CAS的ABA问题是什么，怎么解决 (字节番茄小说)
8. CAS失败了怎么办 (小米)


## 5. 线程池
[线程池](https://blog.csdn.net/HY1273383167/article/details/117414280)
1. 介绍下线程池，讲讲为什么要有线程池 和 底层实现的原理 (京东、携程、拼多多、快手、百度提前批、有赞)
> 线程的创建和销毁有一定系统开销的，对线程的复用，可以在线程频繁创建和结束的场景 有效减少系统开销
> 对线程数量的管理，可以方式系统内存溢出
> 通过 BlockingQueue 可以实现 
> ForkJoinPool 可以让空闲的进程xxx

2. 一个任务进来后，线程池是怎么处理的？(京东科技)
> 源码

3. 参数 (携程、快手、蚂蚁、百度、京东)
   1. 核心线程数与最大线程数之间的关系？(蚂蚁)
   > 当线程数 < 核心线程数时，创建线程
   > 当线程数 >= 核心线程数，且任务队列未满时，将任务放入任务队列
   > 当线程数 >= 核心线程数，且任务队列已满
   >     若线程数 < 最大线程数，创建线程
   >     若线程数 = 最大线程数，默认abort策略 拒绝任务 抛出异常

   2. BlockingQueue 有哪些
   > SynchronousQueue 同步队列，每执行一个插入，需要一个take 才能被唤醒
   > ArrayBlockingQueue 有界数组队列，1 锁 + 2 Condition，FIFO，支持公平和非公平锁
   > LinkedBlockingQueue 可无界链表队列，2 锁 + 2 Condition 效率更优，FIFO，非公平锁
   > PriorityBlockingQueue (无界 数组)优先队列，每插入一个任务，都自动按照优先级在队列中排序

   3. 自定义线程池的最大线程数如何设定 (多益)
   > 处理CPU密集型就 核数 * 2，IO密集型的任务就 核心任务数 * 2

   4. 拒绝策略 (拼多多、京东科技)
   > 1.CallerRunsPolicy - 交给调用者执行，如果大量任务提交给main程序去运行会导致阻塞 损耗性能
   > 2.DiscardPolicy - 丢弃
   > 3.AbortPolicy - 丢弃 并抛异常，默认
   > 4.DiscardOldestPolicy - 丢弃最老的 任务
   
4. ForkJoinPool
   1. 了解Java的线程池吗？里面有一个ForkJoinPool，有没有用过？说一下 (阿里Lazada)
   > 

   2. ForkJoinPool和其他的线程池有什么不一样的地方吗？比如用到了哪些算法 (阿里Lazada)
   > 

5. beforeExecute，afterExecute，terminated 三个AOP操作，还可以实现日志、释放资源等操作
6. 一个线程池中的线程异常了，那么线程池会怎么处理这个线程?
[有的线程它死了，于是它变成一道面试题](https://www.modb.pro/db/150813)
> 用 execute() 执行的话会抛出堆栈异常，但如果用 submit() 的话会将Exception保存起来 不抛出；submit()之后，如果 get() 获取执行结果，也会报错
> 不影响其他线程执行
> 如果一个线程报错，会调用 processWorkerExit 把任务从线程池中移除

6. tomcat的线程模型？tomcat线程池如何实现？(蚂蚁)
7. tomcat servlet接收请求流程 (有赞)
8. 线程池会造成 oom 内存泄漏吗？(蚂蚁)


# 问题
2. ForkJoinPool 是啥
[阿里技术：10问10答](https://blog.csdn.net/HY1273383167/article/details/117414280)